<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lectura de Datos de Firestore</title>
    <style>
        body { font-family: sans-serif; margin: 20px; margin:0; padding:0; }
        .data-item { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; border-radius: 5px; }
        .error { color: red; }
        .main-menu {
            position: fixed;
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: flex-end;
            top: 0;
            right: 0;
            background-color: #2196f3;
            color: white;
            padding: 8px;
            font-weight: bold;
            cursor: move;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            user-select: none;
            width: 100%;
        }
        #user-info {
            display: flex;
            align-items: center;
            flex-direction: column;
            cursor:pointer;
            &:hover {
                background-color: #1976d2;
            }
        }
    </style>
    <script src="./js/ndialogo/ndialogo.js"></script>
    <link rel="stylesheet" href="./js/ndialogo/ndialogo.css">
</head>
<body>
    <div class="main-menu">
        <div id="user-info">
            <img src="" alt="" style="width: 32px; height: 32px;">
            <div>Usuario</div>
        </div>
    </div>
    <h1>Mis Datos de Firestore</h1>
    <a href="login.html">login</a>
    <p>Estos son los datos leídos de tu colección "usuario" en Cloud Firestore:</p>
    <div id="data-container">
        <p>Cargando datos...</p>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

    <script>
        const userInfoElement = document.getElementById('user-info');
        const dlg_intermedio = new Ndialogo();
        const dlg = new Ndialogo();
        userInfoElement.addEventListener('click', () => {
            dlg.open(`Espere...`,false);
            
        });
        const firebaseConfig = {
            apiKey: "AIzaSyDo30GmrPeIYn31jQNIaoWIC85Eew8gu_E",
            authDomain: "carga-de-datos-e6203.firebaseapp.com",
            projectId: "carga-de-datos-e6203",
            storageBucket: "carga-de-datos-e6203.firebasestorage.app",
            messagingSenderId: "138191639020",
            appId: "1:138191639020:web:1962468915082ccff530c9",
            measurementId: "G-G4NQ7XX45W"
        };

        // Inicializa Firebase
        firebase.initializeApp(firebaseConfig);

        // Obtén una referencia a Firestore
        const db = firebase.firestore();

        // Función para leer y mostrar los datos
        async function readFirestoreData() {
            const dataContainer = document.getElementById('data-container');
            dataContainer.innerHTML = ''; // Limpia el contenido previo

            try {
                // Obtenemos una instantánea de la colección 'usuario'
                // Si aún no tienes una colección 'usuario', puedes crearla manualmente en la Consola
                // de Firestore, o agregar un documento en tu app para que se cree automáticamente.
                const querySnapshot = await db.collection("usuario").get();

                if (querySnapshot.empty) {
                    dataContainer.innerHTML = "<p>No hay documentos en la colección 'usuario'. <br>Intenta agregar uno manualmente en la Consola de Firebase para verlo aquí.</p>";
                    return;
                }

                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    const docId = doc.id;
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'data-item';
                    itemDiv.innerHTML = `
                        <strong>ID del Documento:</strong> ${docId}<br>
                        <strong>Datos:</strong> ${JSON.stringify(data, null, 2)}
                    `;
                    dataContainer.appendChild(itemDiv);
                });
            } catch (error) {
                console.error("Error al leer datos de Firestore: ", error);
                dataContainer.innerHTML = `<p class="error">Error al cargar los datos: ${error.message}</p>`;
            }
        }

        // Llama a la función cuando la página se carga
        window.onload = readFirestoreData;
    </script>
</body>
</html>
